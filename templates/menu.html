{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="ru">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

	<!-- SEO Meta Tags -->
	<title>{% if restaurant %}{{ restaurant.name }} - Меню{% else %}Меню ресторана{% endif %}</title>
	<meta name="description" content="{% if restaurant %}{{ restaurant.description|default:'Онлайн меню ресторана' }}{% else %}Онлайн меню ресторана{% endif %}">
	<meta name="keywords" content="меню, ресторан, еда, доставка{% if restaurant %}, {{ restaurant.name }}{% endif %}">
	<meta name="author" content="{% if restaurant %}{{ restaurant.name }}{% else %}QR Menu{% endif %}">

	<!-- Open Graph / Facebook -->
	<meta property="og:type" content="website">
	<meta property="og:title" content="{% if restaurant %}{{ restaurant.name }} - Меню{% else %}Меню ресторана{% endif %}">
	<meta property="og:description" content="{% if restaurant %}{{ restaurant.description|default:'Онлайн меню ресторана' }}{% else %}Онлайн меню ресторана{% endif %}">
	{% if restaurant and restaurant.image %}
	<meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ restaurant.image.url }}">
	{% endif %}

	<!-- Twitter -->
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:title" content="{% if restaurant %}{{ restaurant.name }} - Меню{% else %}Меню ресторана{% endif %}">

	<!-- Favicon -->
	<link rel="icon" type="image/png" href="{% if restaurant and restaurant.image %}{{ restaurant.image.url }}{% else %}{% static 'images/favicon.png' %}{% endif %}">

	<!-- jQuery -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
	<!-- Bootstrap Bundle JS -->
	<script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<!-- Custom Styles -->
	<link rel="stylesheet" href="{% static 'css/style.css' %}">

	<script>
        // URL конфигурация
        var loadDishesUrl = "{% url 'load_dishes' 0 %}";
        var addToCartUrl = "{% url 'add_to_cart' 0 %}";
        var getCartUrl = "{% url 'get_cart' %}";

        // Режим редактирования
        var isEditMode = {{ is_edit_mode|yesno:"true,false" }};
        var editSecretKey = "{{ request.GET.edit|default:'' }}";
	</script>
</head>

<body class="container-fluid">
{% block content %}
{% endblock %}

{% block dashboard %}
	<div class="fixed-header">
		<!-- Логотип ресторана -->
		<img src="{{ restaurant.image.url }}" alt="{{ restaurant.name }}" id="restaurant-logo"
		     class="restaurant-banner">

		<!-- Ряд с корзиной и поиском -->
		<div class="menu-header d-flex justify-content-between align-items-center gap-2">
			<a href="{% url 'view_cart' %}" class="cart-link text-dark position-relative">
				<i class="fas fa-shopping-cart shopping-cart-lg"></i>
				<span id="cart-count"
				      class="badge bg-danger rounded-pill position-absolute  top-0 start-100 translate-middle">
                0
            </span>
			</a>

			<!-- Поисковая строка (скрыта по умолчанию) -->
			<div class="search-container-header" style="display: none;">
				<div class="search-box-header">
					<i class="fas fa-search search-icon-header"></i>
					<input type="text" id="dish-search" class="search-input-header" placeholder="Поиск...">
					<button id="clear-search" class="clear-search-btn-header" style="display: none;">
						<i class="fas fa-times"></i>
					</button>
				</div>
			</div>

			<a href="{% url 'menu' %}" class="menu-title m-0 text-dark d-none">
				<i class="fas fa-arrow-left"></i>
			</a>
		</div>
	</div>
	<div class="container">
	<!-- Список категорий -->
	<div class="categories mt-3">
		{% for category in categories %}
			<div class="category-card">
				<button class="category-btn" data-id="{{ category.id }}">
					<img src="{{ category.image.url }}" alt="{{ category.name }}">
					<span class="category-name">{{ category.name }}</span>
				</button>
			</div>
		{% empty %}
			<p class="text-center">Категории еще не добавлены.</p>
		{% endfor %}
	</div>


	<div id="message-container">
		<p id="message-text"></p>
	</div>

	<!-- Список блюд -->
	<div id="dishes" class="mt-4">

	</div>

	<!-- Пагинация -->
	<div id="pagination" class="mt-4 mb-5"></div>

	<!-- Модальное окно для изображения блюда (кастомное) -->
	<div id="dishModal" class="custom-modal" style="display: none;">
		<div class="custom-modal-backdrop"></div>
		<div class="custom-modal-content">
			<button type="button" class="custom-modal-close" aria-label="Закрыть">
				<i class="fas fa-times"></i>
			</button>
			<img src="" id="modalDishImage" class="custom-modal-image" alt="Блюдо">
		</div>
	</div>

	<!-- Модальное окно редактирования блюда -->
	<div id="editDishModal" class="custom-modal" style="display: none;">
		<div class="edit-modal-backdrop custom-modal-backdrop"></div>
		<div class="edit-modal-content">

			<div class="edit-modal-body">
				<h3 class="mb-4"><i class="fas fa-edit"></i> Редактировать блюдо</h3>
				<form id="edit-dish-form" enctype="multipart/form-data">
					{% csrf_token %}
					<input type="hidden" id="edit-dish-id" name="dish_id">

					<div class="form-group mb-1">
						<label for="edit-dish-name">Название</label>
						<input type="text" id="edit-dish-name" name="name" class="form-control" required>
					</div>

					<div class="form-group mb-1">
						<label for="edit-dish-description">Описание</label>
						<textarea id="edit-dish-description" name="description" class="form-control" rows="1"></textarea>
					</div>

					<div class="form-group mb-1">
						<label for="edit-dish-price">Цена (Sum)</label>
						<input type="number" id="edit-dish-price" name="price" class="form-control" step="0.01" required>
					</div>

					<div class="form-group mb-1">
						<label for="edit-dish-image ">Изображение</label>
						<input type="file" id="edit-dish-image" name="image" class="form-control text-center" accept="image/*">
						<div class="text-center">
							<img id="edit-dish-image-preview" src="" alt="Preview" class="mt-2" style="max-width: 180px;  max-height: 180px; display: none;">
						</div>
					</div>

					<div class="form-check mb-1">
						<input type="checkbox" id="edit-dish-available" name="is_available" class="form-check-input">
						<label for="edit-dish-available" class="form-check-label">В наличии (показывать в меню)</label>
					</div>

					<div class="d-flex gap-2 justify-content-end">
						<button type="button" class="btn btn-secondary edit-modal-close">Отмена</button>
						<button type="submit" class="btn btn-primary">Сохранить</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
	<!-- Footer с социальными сетями -->
	<footer class="text-center border-top">
		<div class="footer-social-links d-flex justify-content-center align-items-center gap-3">
			{% if restaurant %}
				{% if restaurant.instagram %}
				<a href="{{ restaurant.instagram }}" target="_blank" class="footer-social-icon" aria-label="Instagram">
					<i class="fab fa-instagram"></i>
				</a>
				{% endif %}

				{% if restaurant.telegram %}
				<a href="{{ restaurant.telegram }}" target="_blank" class="footer-social-icon" aria-label="Telegram">
					<i class="fab fa-telegram"></i>
				</a>
				{% endif %}

				{% if restaurant.phone %}
				<a href="tel:{{ restaurant.phone }}" class="footer-social-icon" aria-label="Позвонить">
					<i class="fas fa-phone"></i>
				</a>
				{% endif %}
			{% endif %}
		</div>
	</footer>

{% endblock dashboard %}


<script src="{% static 'js/main.js' %}"></script>
</body>
</html>